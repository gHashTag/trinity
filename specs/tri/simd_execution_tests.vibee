name: simd_execution_tests
version: "1.0.0"
language: zig
module: simd_execution_tests

description: |
  End-to-end execution tests for SIMD instructions.
  Verifies that generated SSE/AVX code produces correct results.

types:
  SIMDTestCase:
    fields:
      name: String
      input_a: List<Int>
      input_b: List<Int>
      expected: List<Int>
      operation: String
    description: Test case for SIMD operation verification

  SIMDTestResult:
    fields:
      passed: Bool
      actual: List<Int>
      expected: List<Int>
      cycles: Int
    description: Result of SIMD test execution

behaviors:
  - name: test_paddd_execution
    given: Two 128-bit vectors of 4x i32
    when: Executing PADDD instruction
    then: Result contains element-wise sum

  - name: test_pmulld_execution
    given: Two 128-bit vectors of 4x i32
    when: Executing PMULLD instruction
    then: Result contains element-wise product (low 32 bits)

  - name: test_movdqu_roundtrip
    given: 128-bit data in memory
    when: Loading with MOVDQU and storing back
    then: Data is preserved exactly

  - name: test_vpaddd_256_execution
    given: Two 256-bit vectors of 8x i32
    when: Executing AVX VPADDD instruction
    then: Result contains element-wise sum of all 8 elements

  - name: test_phaddd_horizontal_sum
    given: 128-bit vector of 4x i32
    when: Executing PHADDD twice
    then: Result contains sum of all 4 elements in lowest position

test_cases:
  paddd_basic:
    input_a: [1, 2, 3, 4]
    input_b: [10, 20, 30, 40]
    expected: [11, 22, 33, 44]
    operation: PADDD

  pmulld_basic:
    input_a: [2, 3, 4, 5]
    input_b: [10, 10, 10, 10]
    expected: [20, 30, 40, 50]
    operation: PMULLD

  paddd_negative:
    input_a: [-1, -2, -3, -4]
    input_b: [1, 2, 3, 4]
    expected: [0, 0, 0, 0]
    operation: PADDD

  vpaddd_256:
    input_a: [1, 2, 3, 4, 5, 6, 7, 8]
    input_b: [10, 20, 30, 40, 50, 60, 70, 80]
    expected: [11, 22, 33, 44, 55, 66, 77, 88]
    operation: VPADDD

calling_convention:
  description: |
    SIMD test functions use System V AMD64 ABI:
    - XMM0-XMM7 for passing/returning vector arguments
    - XMM0 for return value
    - Caller-saved: XMM0-XMM15
